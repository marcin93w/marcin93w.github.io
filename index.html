<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‚ù§Ô∏è Iza i Marcin ‚ù§Ô∏è</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: data: https://apis.google.com https://accounts.google.com https://content.googleapis.com https://www.gstatic.com https://ssl.gstatic.com;">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script>
        let tokenClient;
        let accessToken = null;

        function initializeGapiClient() {
            return gapi.client.init({
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
            });
        }

        function setupUpload() {
            const mediaUpload = document.getElementById('mediaUpload');
            const mediaUploadBtn = document.getElementById('mediaUploadBtn');

            gapi.load('client', initializeGapiClient);

            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: '600249699299-bpgdubq7iiie8rrbqps9vnit254hkfph.apps.googleusercontent.com',
                scope: 'https://www.googleapis.com/auth/drive.file',
                callback: (tokenResponse) => {
                    accessToken = tokenResponse.access_token;
                    // Now open file picker
                    mediaUpload.click();
                },
            });

            mediaUploadBtn.addEventListener('click', function() {
                if (!accessToken) {
                    // Must be called directly in the event handler!
                    tokenClient.requestAccessToken();
                } else {
                    mediaUpload.click();
                }
            });

            mediaUpload.addEventListener('change', function() {
                if (mediaUpload.files.length === 0) return;
                const file = mediaUpload.files[0];
                if (!(file.type.startsWith('image/') || file.type.startsWith('video/'))) {
                    alert('Proszƒô wybraƒá plik graficzny lub wideo.');
                    return;
                }
                uploadFile(file);
            });

            function uploadFile(file) {
                const folderId = '1ChOSqybuVrN_mn4K7ZB8YqnkvMHSK7nv';
                const metadata = {
                    name: file.name,
                    mimeType: file.type,
                    parents: [folderId]
                };

                fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json; charset=UTF-8',
                        'X-Upload-Content-Type': file.type,
                        'X-Upload-Content-Length': file.size
                    },
                    body: JSON.stringify(metadata)
                }).then(res => {
                    if (!res.ok) throw new Error('Nie uda≈Ço siƒô zainicjowaƒá przesy≈Çania.');
                    const uploadUrl = res.headers.get('Location');
                    return fetch(uploadUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': file.type,
                            'Content-Length': file.size
                        },
                        body: file
                    });
                }).then(response => {
                    if (response.ok) {
                        alert('Plik zosta≈Ç wys≈Çany do Google Drive.');
                    } else {
                        alert('WystƒÖpi≈Ç b≈ÇƒÖd podczas wysy≈Çania pliku.');
                    }
                }).catch(error => {
                    console.error('B≈ÇƒÖd: ' + JSON.stringify(error, null, 2));
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (window.google && window.google.accounts && window.google.accounts.oauth2) {
                setupUpload();
            } else {
                const gisScript = document.querySelector('script[src*="gsi/client"]');
                gisScript.addEventListener('load', setupUpload);
            }
        });
    </script>
    <style>
        @font-face {
            font-family: 'SpecialFont';
            src: url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.woff') format('woff'),
                 url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.svg#OPTICubaLibreTwo') format('svg'),
                 url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.eot'),
                 url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.eot?#iefix') format('embedded-opentype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            background-color: #293b59;
            font-family: Verdana, sans-serif;
            color: #faebd7;
            text-align: center;
        }

        .top {
            margin-top: 30px;
            margin-bottom: 20px;
        }

        .header {
            font-family: 'SpecialFont', Verdana, sans-serif;
            letter-spacing: 0.15em;
            font-size: 2em;
            text-transform: uppercase;
        }

        .line {
            color: #ffd000;
        }

        .content {
            padding: 0 20px;
            letter-spacing: 0.05em;
        }

        .form {
            margin: 20px auto;
        }

        #mediaUploadBtn {
            padding: 12px 28px;
            background: #ffd000;
            color: #293b59;
            border-radius: 24px;
            font-size: 1em;
            font-family: inherit;
            cursor: pointer;
            transition: background 0.2s, color 0.2s;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(0,0,0,0.07);
            border: none;
            margin-right: 10px;
        }
        #mediaUploadBtn:hover, #mediaUploadBtn:focus {
            background: #ffe066;
            color: #1a2537;
        }
    </style>
</head>
<body>
    <div class="top">
        <div class="header">Izabela</div>
        <div class="header"><img src="oraz.svg" width="150px" /></div>
        <div class="header">Marcin</div>
        <div class="header line"> | </div>
    </div>
    <div class="content">
        <p>Podziel siƒô wspomnieniami! üì∏üé•</p>
        <p>To miejsce stworzyli≈õmy specjalnie dla Was ‚Äì go≈õci weselnych!</p>
        <p>Je≈õli uchwycili≈õcie wyjƒÖtkowe momenty podczas naszego przyjƒôcia ‚Äì zdjƒôcia, filmy, ≈ºyczenia czy wzruszajƒÖce chwile ‚Äì bardzo chcieliby≈õmy je zobaczyƒá.</p>
        <p>Wrzucajcie tutaj swoje materia≈Çy, aby≈õmy mogli razem stworzyƒá piƒôknƒÖ pamiƒÖtkƒô z naszego wesela.</p> 
        <p>Dziƒôkujemy, ≈ºe jeste≈õcie z nami i ≈ºe pomagacie nam zachowaƒá te niezapomniane wspomnienia! ‚ù§Ô∏è</p>
    </div>
    <div class="header line"> | </div>
    <form>
        <div class="form">
            <button type="button" id="mediaUploadBtn">Wybierz plik</button>
            <input type="file" id="mediaUpload" name="mediaUpload" accept="image/*,video/*" style="display:none;">
        </div>
    </form>
</body>
</html>