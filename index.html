<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iza &lt;3 Marcin</title>
    <meta http-equiv="Content-Security-Policy" content="script-src 'self' 'unsafe-inline' 'unsafe-eval' blob: data: https://apis.google.com https://accounts.google.com https://content.googleapis.com https://www.gstatic.com https://ssl.gstatic.com;">
    <script src="https://apis.google.com/js/api.js"></script>
    <script src="https://accounts.google.com/gsi/client"></script>
    <script>
        let tokenClient;
        let accessToken = null;

        function initializeGapiClient() {
            return gapi.client.init({
                discoveryDocs: ['https://www.googleapis.com/discovery/v1/apis/drive/v3/rest'],
            });
        }

        function setupUpload() {
            const mediaUpload = document.getElementById('mediaUpload');
            const uploadBtn = document.getElementById('uploadBtn');

            gapi.load('client', initializeGapiClient);

            tokenClient = google.accounts.oauth2.initTokenClient({
                client_id: '600249699299-bpgdubq7iiie8rrbqps9vnit254hkfph.apps.googleusercontent.com',
                scope: 'https://www.googleapis.com/auth/drive.file',
                callback: (tokenResponse) => {
                    accessToken = tokenResponse.access_token;
                    // Upload after token is received
                    if (mediaUpload.files.length > 0) {
                        uploadFile(mediaUpload.files[0]);
                    }
                },
            });

            uploadBtn.addEventListener('click', function() {
                if (mediaUpload.files.length === 0) {
                    alert('Najpierw wybierz plik.');
                    return;
                }
                const file = mediaUpload.files[0];
                if (!(file.type.startsWith('image/') || file.type.startsWith('video/'))) {
                    alert('ProszÄ™ wybraÄ‡ plik graficzny lub wideo.');
                    return;
                }
                if (!accessToken) {
                    // Must be called directly in the event handler!
                    tokenClient.requestAccessToken();
                } else {
                    uploadFile(file);
                }
            });

            function uploadFile(file) {
                const folderId = '1ChOSqybuVrN_mn4K7ZB8YqnkvMHSK7nv';
                const metadata = {
                    name: file.name,
                    mimeType: file.type,
                    parents: [folderId]
                };

                fetch('https://www.googleapis.com/upload/drive/v3/files?uploadType=resumable', {
                    method: 'POST',
                    headers: {
                        'Authorization': 'Bearer ' + accessToken,
                        'Content-Type': 'application/json; charset=UTF-8',
                        'X-Upload-Content-Type': file.type,
                        'X-Upload-Content-Length': file.size
                    },
                    body: JSON.stringify(metadata)
                }).then(res => {
                    if (!res.ok) throw new Error('Nie udaÅ‚o siÄ™ zainicjowaÄ‡ przesyÅ‚ania.');
                    const uploadUrl = res.headers.get('Location');
                    return fetch(uploadUrl, {
                        method: 'PUT',
                        headers: {
                            'Content-Type': file.type,
                            'Content-Length': file.size
                        },
                        body: file
                    });
                }).then(response => {
                    if (response.ok) {
                        alert('Plik zostaÅ‚ wysÅ‚any do Google Drive.');
                    } else {
                        alert('WystÄ…piÅ‚ bÅ‚Ä…d podczas wysyÅ‚ania pliku.');
                    }
                }).catch(error => {
                    console.error('BÅ‚Ä…d: ' + JSON.stringify(error, null, 2));
                });
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            if (window.google && window.google.accounts && window.google.accounts.oauth2) {
                setupUpload();
            } else {
                const gisScript = document.querySelector('script[src*="gsi/client"]');
                gisScript.addEventListener('load', setupUpload);
            }
        });
    </script>
    <style>
        @font-face {
            font-family: 'SpecialFont';
            src: url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.woff') format('woff'),
                 url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.svg#OPTICubaLibreTwo') format('svg'),
                 url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.eot'),
                 url('OPTIGaramondSpecial-Light/OPTIGaramondSpecial-Light.ttf.eot?#iefix') format('embedded-opentype');
            font-weight: normal;
            font-style: normal;
        }
        body {
            background-color: #293b59;
            font-family: Verdana, sans-serif;
            color: #faebd7;
            text-align: center;
        }

        .top {
            margin-top: 20px;
            margin-bottom: 20px;
        }

        .header {
            font-family: 'SpecialFont', Verdana, sans-serif;
            letter-spacing: 0.15em;
            font-size: 2em;
            text-transform: uppercase;
        }

        .line {
            color: #ffd000;
        }

        .content {
            padding: 0 20px;
            letter-spacing: 0.05em;
        }

        .form {
            margin: 20px auto;
        }
    </style>
</head>
<body>
    <div class="top">
        <div class="header">Izabela</div>
        <div class="header"><img src="oraz.svg" width="150px" /></div>
        <div class="header">Marcin</div>
        <div class="header line"> | </div>
    </div>
    <div class="content">
        <p>Podziel siÄ™ wspomnieniami! ğŸ“¸ğŸ¥</p>
        <p>To miejsce stworzyliÅ›my specjalnie dla Was â€“ goÅ›ci weselnych!</p>
        <p>JeÅ›li uchwyciliÅ›cie wyjÄ…tkowe momenty podczas naszego przyjÄ™cia â€“ zdjÄ™cia, filmy, Å¼yczenia czy wzruszajÄ…ce chwile â€“ bardzo chcielibyÅ›my je zobaczyÄ‡.</p>
        <p>Wrzucajcie tutaj swoje materiaÅ‚y, abyÅ›my mogli razem stworzyÄ‡ piÄ™knÄ… pamiÄ…tkÄ™ z naszego wesela.</p> 
        <p>DziÄ™kujemy, Å¼e jesteÅ›cie z nami i Å¼e pomagacie nam zachowaÄ‡ te niezapomniane wspomnienia! â¤ï¸</p>
    </div>
    <div class="header line"> | </div>
    <form>
        <div class="form">
            <input type="file" id="mediaUpload" name="mediaUpload" accept="image/*,video/*">
        </div>
        <div class="form">
            <button type="button" id="uploadBtn">WyÅ›lij plik</button>
        </div>
    </form>
</body>
</html>